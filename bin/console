#!/usr/bin/env php
<?php
require_once __DIR__ . '/../vendor/autoload.php';

use Threaded\Autoloader;
use Threaded\Divan;
use Threaded\Task;

$divan = new Divan('172.17.0.1', 5984, 'root', 'X5ud07rm');
print_r($divan->getAllDatabases());

$pool = new Pool(5, Autoloader::class, [__DIR__ . '/../vendor/autoload.php']);
/* submit a task to the pool */
$pool->submit(new Task(random_int(1, 100)));
$pool->submit(new Task(random_int(1, 100)));
$pool->submit(new Task(random_int(1, 100)));
$pool->submit(new Task(random_int(1, 100)));
$pool->submit(new Task(random_int(1, 100)));
$pool->submit(new Task(random_int(1, 100)));
$pool->submit(new Task(random_int(1, 100)));
$pool->submit(new Task(random_int(1, 100)));
$pool->submit(new Task(random_int(1, 100)));
$pool->submit(new Task(random_int(1, 100)));
/* in the real world, do some ::collect somewhere */
/* shutdown, because explicit is good */
$pool->shutdown();

print_r($divan->getAllDatabases());
